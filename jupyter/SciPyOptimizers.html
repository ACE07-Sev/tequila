<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tequila Tutorial: &#8212; tequila 0.0.3 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Optimize Measurements by grouping into commuting cliques" href="MeasurementGroups.html" />
    <link rel="prev" title="Optimization" href="Optimizer_Tutorial.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Tequila</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href=".././tequila_presentation.html">Overview</a></li>
                <li><a href=".././README.html">Installation</a></li>
                <li><a href=".././package/index.html">API</a></li>
                <li><a href="https://github.com/aspuru-guzik-group/tequila">GitHub</a></li>
                <li><a href=".././tutorials.html">Tutorials</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Tequila</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantum-backends">Quantum Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantumchemistry">QuantumChemistry:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#troubleshooting">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../package/index.html">Tequila Library Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="Optimizer_Tutorial.html" title="Previous Chapter: Optimization"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Optimization</span>
    </a>
  </li>
  <li>
    <a href="MeasurementGroups.html" title="Next Chapter: Optimize Measurements by grouping into commuting cliques"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Optimize Meas... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/jupyter/SciPyOptimizers.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="tequila-tutorial">
<h1>Tequila Tutorial:<a class="headerlink" href="#tequila-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="handling-optimizers-initializing-parametrized-circuits">
<h2>Handling Optimizers, Initializing parametrized circuits<a class="headerlink" href="#handling-optimizers-initializing-parametrized-circuits" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import everything we need here</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">numpy</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">numpy</span>
</pre></div>
</div>
<p>In the following example we will optimize a simple two qubit VQE with an
Ansatz that is parametrized by two parameters. The Hamiltonian is also
very simple and defined in the box below.</p>
<div class="math notranslate nohighlight">
\[H = \sigma_x(1) + c \sigma_z(1) - \sigma_z(0)\]</div>
<p>The tutorial is <strong>not</strong> a guideline to optimization strategies but only
intends to show tequilas functionality</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Lets take a look at the spectrum of this very simple Hamiltonian</div>
<div class="line">Keep in mind: Tequila is not a numerical linear algebra package, so
better not try to diagonalize Hamiltonians</div>
<div class="line">we however added this feature for user convenience in examples</div>
<div class="line">In the future we might have interfaces to more powerfull numerical
packages … feel free to contribute :-)</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matrix</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">()</span>
<span class="n">e</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
<span class="n">e</span>
</pre></div>
</div>
<p>And here we initialize our Ansatz circuit which is parametrized by a and
b.</p>
<p>We show to ways to initialize Variables: Variable a is initialized with
a convenience string based initialization Variable b is initialized as
Variable which allows you to conveniently transforming it when
initializing gates. Here we do a simple rescaling as an example Note
that you don’t need strings to name variables but can use any hashable
non-numeric type (meaning anything that is not interpreted as number).</p>
<p>For example: tq.Variable(name=(0,1,2,3)) will also work</p>
<p>The Ansatz has no specific meaning and it is more to show different ways
how to deal with variables. See for instance that you can scale them and
use the same variable in multiple gates. (See the other tutorials for
more examples)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># optimize a in units of 2pi</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># optimize b in units of 2pi</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="c1"># optimize c in units of 2pi</span>

<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=-</span><span class="n">b</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nice output (depends on which backends you have installed)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
<p>In the next box we form an objective out of our Hamiltonian and our
Ansatz and pass it down to the optimizer. In the following boxes we show
how the results of the optimizer can be plotted</p>
<p>See further below for some small exercises and additional information</p>
<p>First lets see how objectives are created and simulated</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
<span class="n">wfn</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
<span class="n">evaluate_squared</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">O</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;energy : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wfn    : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wfn</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;squared: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluate_squared</span><span class="p">))</span>
</pre></div>
</div>
<p>Now the objective can be optimized</p>
<div class="line-block">
<div class="line">We will also set the initial values of the variables that can be
passed to the optimizer.</div>
<div class="line">Values of variables are passed as dictionaries where the keys are
tequila variables and the values are floats.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initial_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">}</span>
<span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># final energy</span>
<span class="n">result</span><span class="o">.</span><span class="n">energy</span>
</pre></div>
</div>
<p>Plot out the History: Note, that we choose bad initial points since they
are close to the maximum</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;angles&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convenience in the history plot</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="s1">&#39;angles&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">property</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;angles&#39;</span><span class="p">,</span> <span class="s1">&#39;gradients&#39;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="faq">
<h1>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-can-i-extract-the-parameters-from-a-given-circuit">
<h2>1: How can I extract the parameters from a given circuit?<a class="headerlink" href="#how-can-i-extract-the-parameters-from-a-given-circuit" title="Permalink to this headline">¶</a></h2>
<p>Call the ‘extract_parameters’ attribute and get back a list of all
Variables in the circuit</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">angles</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">()</span>
<span class="n">angles</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-do-measurement-based-simulation">
<h2>2: How can I do measurement based simulation?<a class="headerlink" href="#how-can-i-do-measurement-based-simulation" title="Permalink to this headline">¶</a></h2>
<p>Pass down the ‘samples’ keyword to simulate finite samples See the later
exercises to play around with sample number and optimization methods.</p>
<p>Feel free to play around with the number of samples Don’t excpect
miracles from the optimizer, you might need to hit return a few times or
increase the number of samples.Note that stochastic gradients are not
yet supported Note also that we did not set the initial parameters, so
we will start with all parameters set to 0 which is a stationary point
in this example (full wavefunction simulation would get stuck, see also
the exercise below).</p>
<p>Sampling based simulation needs improvement. Don’t expect too much, but
feel free to contribute</p>
<p>Lets only optimize veriable b and set the other to the correct value to
also show how that works</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">initial_values</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">initial_values</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">initial_values</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="n">initial_values</span> <span class="o">=</span> <span class="n">initial_values</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;result = &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="which-simulator-was-used-and-how-can-i-choose-the-simulator">
<h2>3: Which Simulator was used and how can I choose the simulator?<a class="headerlink" href="#which-simulator-was-used-and-how-can-i-choose-the-simulator" title="Permalink to this headline">¶</a></h2>
<p>You can pass down the simulator to the optimizer by the simulator
keyword (see below) If no specific simulator was chosen by you that
means the simulator is automatically picked. Which simulator is picked
depends on what simulators you have installed and if you demanded a full
wavefunction to be simulated or not.</p>
<p>You can check which simulators you have installed with the following</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">show_available_simulators</span><span class="p">())</span>
</pre></div>
</div>
<p>Here is how you would initialize a simulator and pass it down the
optimizer. The if statement is just to prevent your Ipython kernel from
crashing when you have not installed the simulator Feel free to change
it to something you have installed</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;qiskit&#39;</span> <span class="ow">in</span> <span class="n">tq</span><span class="o">.</span><span class="n">INSTALLED_BACKENDS</span><span class="p">:</span> <span class="c1"># failsafe to only execute cell when qiskit is actually there</span>
    <span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span>
                                       <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">,</span>
                                       <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;qiskit&quot;</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-use-numerical-evaluation-of-gradients">
<h2>4: Can I use numerical evaluation of gradients<a class="headerlink" href="#can-i-use-numerical-evaluation-of-gradients" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Yes you can, by passing down <code class="docutils literal notranslate"><span class="pre">use_gradient</span> <span class="pre">=</span> <span class="pre">False</span></code> or
<code class="docutils literal notranslate"><span class="pre">use_gradient</span> <span class="pre">=</span> <span class="pre">&quot;2-point&quot;</span></code>.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">use_gradient</span> <span class="pre">=</span> <span class="pre">'3-point'</span> <span class="pre">or</span> <span class="pre">'cs'</span></code> are also possible for scipy
methods which support them.</div>
<div class="line">Check out the documentation of scipy.optimize.minimize for that.</div>
<div class="line">You can also pass down further options (again, check scipy
documentation) for different methods.</div>
<div class="line">An important additional option is <code class="docutils literal notranslate"><span class="pre">eps</span></code> which defines the stepsizes
for the ‘2-point’ method.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span>
                     <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">,</span>
                     <span class="n">use_gradient</span><span class="o">=</span><span class="s1">&#39;2-point&#39;</span><span class="p">,</span>
                     <span class="n">method_options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-use-hessian-based-optimizations-and-can-i-evaluate-hessians-numerically">
<h2>5: Can I use Hessian based optimizations, and can I evaluate Hessians numerically?<a class="headerlink" href="#can-i-use-hessian-based-optimizations-and-can-i-evaluate-hessians-numerically" title="Permalink to this headline">¶</a></h2>
<p>Yes you can, by just picking those methods (like for example ‘dogleg’ or
‘newton-cg’). For all ‘trust-*’ methods you can also pick different
options (see again scipy documentation)</p>
<div class="line-block">
<div class="line">Numerical evaluation for hessians works in the same way as for
gradients by passing down <code class="docutils literal notranslate"><span class="pre">use_hessian</span></code> instead of <code class="docutils literal notranslate"><span class="pre">use_gradient</span></code>.</div>
<div class="line">Be aware that not all combinations of <code class="docutils literal notranslate"><span class="pre">use_gradient</span></code> and
<code class="docutils literal notranslate"><span class="pre">use_hessian</span></code> will work (usually you need to have the gradients
analytically) and that most scipy methods do not support numerical
evaluation of Hessians. Also do not confuse that with methods which
use an approximation of the Hessian. Again: Check the scipy
documentation for more information</div>
</div>
<p>Here comes a small example where (note that the methods above will not
converge to the minimum for this initial_values)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">optimizer_scipy</span><span class="o">.</span><span class="n">OptimizerSciPy</span><span class="o">.</span><span class="n">hessian_based_methods</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;initial_tr_radius&quot;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;max_tr_radius&quot;</span><span class="p">:</span><span class="mf">0.1</span>
<span class="p">}</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">optimizer_scipy</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span>
                                    <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">},</span>
                                    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;trust-exact&quot;</span><span class="p">,</span>
                                    <span class="n">method_options</span> <span class="o">=</span> <span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h1>
<p>See farther down for solutions</p>
<div class="section" id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h2>
<p>You can pass down initial_values to the optimizer in the same format as
you can do it with the circuit (see above). Figure out how to do that by
checking out the documentation of the ‘minimize’ function.</p>
</div>
<div class="section" id="exercise-2">
<h2>Exercise 2<a class="headerlink" href="#exercise-2" title="Permalink to this headline">¶</a></h2>
<p>Figure out which method the optimizer above used and how to use a
different optimization method.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># hints</span>
<span class="n">tq</span><span class="o">.</span><span class="n">show_available_optimizers</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="exercise-3">
<h2>Exercise 3<a class="headerlink" href="#exercise-3" title="Permalink to this headline">¶</a></h2>
<p>If you initialize both parameters to 0.0 you will directly hit a
stationary point which causes the optimizer stop. Find out how you can
impose bounds on the variables in order to prevent the optimizer from
hitting that point.</p>
<p>Again: Check the documentation of the ‘minimize’ function.</p>
<p>Note: Not all optimization methods of SciPy support bounds on the
variables</p>
<p>Note: It is not enough to just restrict the point 0.0</p>
</div>
</div>
<div class="section" id="solutions">
<h1>Solutions<a class="headerlink" href="#solutions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="exercise-1-2">
<h2>Exercise 1 &amp; 2<a class="headerlink" href="#exercise-1-2" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>Exercise 3<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this will get stuck (similar for other gradient based optimizers)</span>
<span class="n">zeroes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
<span class="n">shift</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;TNC&#39;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">zeroes</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># bounding the variables to keep it away from the stationary point which occurs at 0 and is periodic in 2pi</span>
<span class="c1"># using negative values since that converges faster</span>
<span class="n">zeroes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
<span class="n">shift</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">),</span> <span class="s1">&#39;c&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span> <span class="p">}</span>
<span class="n">O</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Objective</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;TNC&#39;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">zeroes</span><span class="p">,</span> <span class="n">method_bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Matter Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>