<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Frequently Asked Questions: &#8212; tequila XXXXX documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tequila Chemistry Basics" href="Chemistry.html" />
    <link rel="prev" title="Tequila Basic Usage" href="BasicUsage.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Tequila</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href=".././tequila_presentation.html">Overview</a></li>
                <li><a href=".././install.html">Installation</a></li>
                <li><a href=".././package/index.html">API</a></li>
                <li><a href="https://github.com/aspuru-guzik-group/tequila">GitHub</a></li>
                <li><a href=".././tutorials.html">Tutorials</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Tequila</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantum-backends">Quantum Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantumchemistry">QuantumChemistry:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#troubleshooting">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../package/index.html">Tequila Library Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="BasicUsage.html" title="Previous Chapter: Tequila Basic Usage"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Tequila Basic Usage</span>
    </a>
  </li>
  <li>
    <a href="Chemistry.html" title="Next Chapter: Tequila Chemistry Basics"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tequila Chemi... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/jupyter/FAQ.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions:<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="it-is-recommended-to-take-a-look-at-the-basicusage-notebook-before-looking-at-this">
<h2>It is recommended to take a look at the <code class="docutils literal notranslate"><span class="pre">BasicUsage</span></code> notebook before looking at this<a class="headerlink" href="#it-is-recommended-to-take-a-look-at-the-basicusage-notebook-before-looking-at-this" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="section" id="which-optimization-methods-can-i-use">
<h2>Which optimization methods can I use?<a class="headerlink" href="#which-optimization-methods-can-i-use" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">tq.show_available_optimizers</span></code> shows you all installed modules no your
systems and the methods which <code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code> understands. Method names
are not case sensitive when passed to <code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code>.</p>
<div class="line-block">
<div class="line">In the end you see which modules are supported and which of them are
actually installed on your system.</div>
<div class="line">The table with methods and modules will only show you the methods for
modules that are currently installed within your environment.</div>
</div>
<div class="line-block">
<div class="line">Of course you can also use tequila objectives for your own optimizers.</div>
<div class="line">You don’t need to use the modules here.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">show_available_optimizers</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="which-simulators-quantum-backends-can-i-use">
<h2>Which simulators/Quantum-Backends can I use?<a class="headerlink" href="#which-simulators-quantum-backends-can-i-use" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">tq.show_available_simulators</span></code> shows all simulators/quantum backends
which are supported by tequila as well as which are installed within
your current environment.</p>
<p>The default choice if you don’t specify a backend when for example
simulating a tequila objective with <code class="docutils literal notranslate"><span class="pre">tq.simulate</span></code> is the first entry
of the supported backends which is installed on your system.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">show_available_simulators</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-avoid-re-translation-compilation-on-my-objectives-circuits">
<h2>Can I avoid re-translation/compilation on my objectives/circuits?<a class="headerlink" href="#can-i-avoid-re-translation-compilation-on-my-objectives-circuits" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Yes you can. By calling <code class="docutils literal notranslate"><span class="pre">tq.compile</span></code> instead of <code class="docutils literal notranslate"><span class="pre">tq.simulate</span></code>.
This will give you back a callable objective.</div>
<div class="line">Check also the <code class="docutils literal notranslate"><span class="pre">basic</span> <span class="pre">usage</span></code> tutorial notebook</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># simulate the wavefunction with different variables</span>
<span class="n">wfn0</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
<span class="n">wfn1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">wfn0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wfn1</span><span class="p">)</span>

<span class="c1"># the same, but avoiding re-compilation</span>
<span class="c1"># Note that your compiled object is translated to a quantum backend</span>
<span class="c1"># if the backend was not set, tequila it will pick the default which depends</span>
<span class="c1"># on which backends you have installed. You will seee it in the printout of the</span>
<span class="c1"># compiled circuits</span>
<span class="n">compiled_U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
<span class="n">wfn0</span> <span class="o">=</span> <span class="n">compiled_U</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">})</span>
<span class="n">wfn1</span> <span class="o">=</span> <span class="n">compiled_U</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compiled circuit:&quot;</span><span class="p">,</span> <span class="n">compiled_U</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wfn0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wfn1</span><span class="p">)</span>


<span class="c1"># With Objectives it works in the same way</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">E</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.0</span>

<span class="c1"># simulate the objective with different variables</span>
<span class="n">result0</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compiled objective:&quot;</span><span class="p">,</span> <span class="n">objective</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>

<span class="c1"># compile and then simulate</span>
<span class="n">compiled_objective</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">objective</span><span class="p">)</span>
<span class="n">result0</span> <span class="o">=</span> <span class="n">compiled_objective</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">})</span>
<span class="n">result1</span> <span class="o">=</span> <span class="n">compiled_objective</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compiled objective:&quot;</span><span class="p">,</span> <span class="n">compiled_objective</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-run-on-a-real-quantum-computer">
<h2>How can I run on a real quantum computer?<a class="headerlink" href="#how-can-i-run-on-a-real-quantum-computer" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Tequila can both emulate – and when possible, operate via – real
quantum devices. For example: IBM’s Qiskit can be used to run on some
of IBM’s public accessible quantum computers. All you need for this is
an ibm account (Follow the instructions under “Configure your IBM
Quantum Experience credentials” here:
<a class="reference external" href="https://github.com/Qiskit/qiskit-ibmq-provider">https://github.com/Qiskit/qiskit-ibmq-provider</a>).</div>
<div class="line">Tequila also supports Rigetti’s PyQuil and Google’s Cirq, but
currently there are no publicly available devices.</div>
</div>
<p>Here is a small example with Qiskit (you need to have qiskit installed,
and an activaged IBMQ account for this). Alternatively you can also
externally initialize your chosen device, and pass this down instead of
a string.</p>
<p>You always need to set samples if you intend to run on a real (or
emulated) backend.</p>
<div class="line-block">
<div class="line">If you have special access rights you can initialize the <code class="docutils literal notranslate"><span class="pre">qiskit</span></code>
quantum backend yourself and pass it down as <code class="docutils literal notranslate"><span class="pre">device</span></code> instead of the
device name.</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">device</span> <span class="pre">=</span> <span class="pre">provider.get_backend(name)</span></code> or as a dictionary with
<code class="docutils literal notranslate"><span class="pre">qiskit</span></code> provider and devicename</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">device</span> <span class="pre">=</span> <span class="pre">{&quot;provider&quot;:provider_instance,</span> <span class="pre">&quot;name&quot;:device_name}</span></code></div>
</div>
<p>Here is a small toy example that minimizes the square of a one qubit
expectation value (minimum is 0.0)</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># simulate the square of the expectation value with a specific set of variables</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;qiskit&quot;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;ibmq_ourense&#39;</span>

<span class="c1"># optimize using ond of IMB&#39;s quantum computers as quantum backend</span>
<span class="c1"># (check your ibm account for more information and keywords)</span>
<span class="c1"># note that the names of the computer might have changed</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;qiskit&quot;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;ibmq_ourense&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-can-i-emulate-a-real-quantum-computer">
<h2>How can I emulate a real quantum computer?<a class="headerlink" href="#how-can-i-emulate-a-real-quantum-computer" title="Permalink to this headline">¶</a></h2>
<p>Emulation is performed similarly to running on real devices. All you
need to do is pass down the right string to the ‘device’ keyword. For
qiskit, these are the same as for regular backends, but have’fake_’ at
the beginning; I.E to emulate ‘armonk;, set <code class="docutils literal notranslate"><span class="pre">device=&quot;fake_armonk&quot;</span></code>.
For PyQuil, this is done by adding ‘-qvm’ to the end of the chosen
string, i.e, ‘Aspen-8’ becomes <code class="docutils literal notranslate"><span class="pre">device=Aspen-8-qvm'</span></code>. For Cirq, only
emulation is currently possible; the only string options for cirq are
‘foxtail’,’bristlecone’,’sycamore’, and ‘sycamore23’.</p>
<p>When emulating, a few things about the real device will be mimicked,
principally its native gate set and its connectivities. Emulation will
NOT include noisy emulation by default; If you want to emulate noise,
pass down the keyword <code class="docutils literal notranslate"><span class="pre">noise='device'</span></code>. Using this option without
specifying a device will result in an error.</p>
<p>Below, we will emulate pyquil’s Aspen 8, with emulated noise. You need
pyquil installed for this to work.</p>
<p>additionally: when real backends cannot be accessed, emulation will be
attempted, with a warning.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># simulate the square of the expectation value with a specific set of variables</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;pyquil&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampling from pyquil yielded: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;pyquil&quot;</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="s1">&#39;Aspen-8-qvm&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampling from pyquil while emulating Aspen-8 yielded: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">optimizer_scipy</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">E</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">},</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                                    <span class="n">backend</span><span class="o">=</span><span class="s1">&#39;pyquil&#39;</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;Aspen-8-qvm&quot;</span><span class="p">,</span>
                                    <span class="n">noise</span><span class="o">=</span><span class="s1">&#39;device&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimizing while emulating Aspen-8 with noise yielded a best energy of: &#39;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-compile-objectives-into-different-backends">
<h2>Can I compile Objectives into different backends?<a class="headerlink" href="#can-i-compile-objectives-into-different-backends" title="Permalink to this headline">¶</a></h2>
<p>Yes you can. Tequila will print a warning if this happens. Warnings can
be ignored by filtering them out (see the python warnings documentation)</p>
<p>If a compiled circuit is used as input to compile then tequila will
re-compile the circuit to the new backend (it it differs from the
previous one)</p>
<p>If a compiled objective is used as input to compile then tequila will
only compile non-compiled expectationvalues into the different backend.
Already compiled expectation values will remain untouched</p>
<div class="line-block">
<div class="line">Note that you need at least two different backends for the following
cell to execute.</div>
<div class="line">Just change the key to whatever you have installed.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">backend1</span> <span class="o">=</span> <span class="s2">&quot;qulacs&quot;</span>
<span class="n">backend2</span> <span class="o">=</span> <span class="s2">&quot;cirq&quot;</span>

<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Example Circuit: &quot;</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
<span class="n">compiled_1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend1</span><span class="p">)</span>
<span class="n">compiled_2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">compiled_1</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit compiled to </span><span class="si">{}</span><span class="s2"> -&gt; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend1</span><span class="p">),</span> <span class="n">compiled_1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Circuit compiled to </span><span class="si">{}</span><span class="s2"> -&gt; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">backend1</span><span class="p">),</span> <span class="n">compiled_1</span><span class="p">)</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">make objective with H = &quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="n">objective</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>
<span class="n">compiled_1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ExpectationValues of objective 1:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">compiled_1</span><span class="p">)</span>

<span class="n">objective2</span> <span class="o">=</span> <span class="n">compiled_1</span> <span class="o">+</span> <span class="n">objective</span> <span class="c1"># Its recommended to avoid those hybrids, but in principle it works</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ExpectationValues of partly compiled objective:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">objective2</span><span class="p">)</span>

<span class="n">compiled_2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">objective2</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ExpectationValues of hybdrid compiled objective:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">compiled_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-i-transform-measurements-into-hamiltonians">
<h2>How do I transform Measurements into Hamiltonians?<a class="headerlink" href="#how-do-i-transform-measurements-into-hamiltonians" title="Permalink to this headline">¶</a></h2>
<p>We can not answer this question in general, but we can try to give a
small example here.</p>
<p>Assume you have a quantum circuit with <span class="math notranslate nohighlight">\(4\)</span> Qubits and you are
measuring Qubit <span class="math notranslate nohighlight">\(0\)</span> and <span class="math notranslate nohighlight">\(2\)</span>. You define your cost function
in the following way:</p>
<div class="math notranslate nohighlight">
\[L(AB) = A + B, \qquad A,B \in \left\{ 0,1 \right\}\]</div>
<p>meaning you accumulate the number of ones measured in your circuit.</p>
<p>The corresponding expectationvalue would be</p>
<div class="math notranslate nohighlight">
\[L = \langle \Psi \rvert H \lvert \Psi \rangle \qquad H = 1 - \frac{1}{2}\left(Z(0) + Z(1)\right)\]</div>
<p>The Hamiltonian could also be written as</p>
<div class="math notranslate nohighlight">
\[H = 2\lvert 11 \rangle \langle 11 \rvert + \lvert 10 \rangle \langle 10 \rvert + \lvert 01 \rangle \langle 01 \rvert\]</div>
<p>Tequila provides the convenience function <code class="docutils literal notranslate"><span class="pre">tq.gates.Projector</span></code> to
initialize Hamiltonians like that</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Projector</span><span class="p">(</span><span class="s2">&quot;|11&gt;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Projector</span><span class="p">(</span><span class="s2">&quot;|01&gt;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Projector</span><span class="p">(</span><span class="s2">&quot;|10&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">The projector can also be initialized with more structured
<code class="docutils literal notranslate"><span class="pre">QubitWaveFunction</span></code>s which can itself be initialized from array or
string.</div>
<div class="line">Here are some examples</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfn</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;1.0*|00&gt; + 1.0*|11&gt;&quot;</span><span class="p">)</span>
<span class="n">wfnx</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wfn</span> <span class="o">==</span> <span class="n">wfnx</span><span class="p">)</span>
<span class="n">wfn</span> <span class="o">=</span> <span class="n">wfn</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wfn</span><span class="p">)</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Projector</span><span class="p">(</span><span class="n">wfn</span><span class="o">=</span><span class="n">wfn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P = &quot;</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
</pre></div>
</div>
<p>Apart from <code class="docutils literal notranslate"><span class="pre">Projector</span></code> there is also <code class="docutils literal notranslate"><span class="pre">KetBra</span></code> which intialized more
general operators like</p>
<div class="math notranslate nohighlight">
\[\lvert \Psi \rangle \langle \Phi \rvert\]</div>
<div class="line-block">
<div class="line">Keep in mind that those are not hermitian.</div>
<div class="line">But they can be split up into their hermitian and anti hermitian part
where both can then be used as hamiltonians for expectationvalues.</div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">hermitian</span> <span class="pre">=</span> <span class="pre">True</span></code> key is set, the function returns the
hermitian version of the operator (which is the same as the hermitian
part of the old operator)</p>
<div class="math notranslate nohighlight">
\[\frac{1}{2}\left(\lvert \Psi \rangle \langle \Phi \rvert + \lvert \Phi \rangle \langle \Psi \rvert \right)\]</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfn1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;1.0*|00&gt; + 1.0*|11&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>

<span class="n">op</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">KetBra</span><span class="p">(</span><span class="n">bra</span><span class="o">=</span><span class="n">wfn1</span><span class="p">,</span> <span class="n">ket</span><span class="o">=</span><span class="s2">&quot;|00&gt;&quot;</span><span class="p">)</span>

<span class="n">H1</span><span class="p">,</span> <span class="n">H2</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;operator=&quot;</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hermitian part      = &quot;</span><span class="p">,</span> <span class="n">H1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;anti-hermitian part =&quot;</span><span class="p">,</span> <span class="n">H2</span><span class="p">)</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">KetBra</span><span class="p">(</span><span class="n">bra</span><span class="o">=</span><span class="n">wfn1</span><span class="p">,</span> <span class="n">ket</span><span class="o">=</span><span class="s2">&quot;|00&gt;&quot;</span><span class="p">,</span> <span class="n">hermitian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hermitianized operator = &quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-do-basic-operations-on-wavefunctions-and-operators-without-quantum-backends">
<h2>Can I do basic operations on wavefunctions and operators without quantum backends?<a class="headerlink" href="#can-i-do-basic-operations-on-wavefunctions-and-operators-without-quantum-backends" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">In principle yes. But keep in mind that tequila was not made for this.</div>
<div class="line">However, some of those operations might come in handy for debugging or
small examples.</div>
</div>
<p>You can not execute circuits without a simulator since they are just
abstract data types (no matrices or anything). Tequila has however its
own small debug simulator <code class="docutils literal notranslate"><span class="pre">backend</span> <span class="pre">=</span> <span class="pre">symbolic</span></code> but there is no reason
to use it if you have any other quantum backend installed.</p>
<p>Hamiltonians can be converted to matrices.</p>
<p>We give a few examples here</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfn</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;1.0*|0&gt; + 1.0*|1&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">wfn2</span> <span class="o">=</span> <span class="n">wfn</span><span class="o">.</span><span class="n">apply_qubitoperator</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|wfn&gt;  = &quot;</span><span class="p">,</span> <span class="n">wfn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;H      = &quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;H|wfn&gt; = &quot;</span><span class="p">,</span> <span class="n">wfn2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wfn1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;1.0*|0&gt; + 1.0*|1&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">wfn2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitWaveFunction</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;1.0*|0&gt; - 1.0*|1&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;wfn1|wfn2&gt; = &quot;</span><span class="p">,</span> <span class="n">wfn1</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">wfn2</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-import-an-hamiltonian-from-openfermion">
<h2>Can I import an Hamiltonian from OpenFermion?<a class="headerlink" href="#can-i-import-an-hamiltonian-from-openfermion" title="Permalink to this headline">¶</a></h2>
<p>Yes! OpernFermion is currently tequilas backend for Hamiltonians, which
makes importing from it straight forward. You just need to wrap the
OpenFermion QubitOperator into tequilas QubitHamiltonian.</p>
<p>We show a few examples</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openfermion</span> <span class="kn">import</span> <span class="n">QubitOperator</span>

<span class="c1"># get OpenFermion QubitOperator from tequila QubitHamiltonian</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">of_operator</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">to_openfermion</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">H</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">of_operator</span><span class="p">),</span> <span class="n">of_operator</span><span class="p">))</span>

<span class="c1"># init tequila QubitHamiltonian with OpenFermion QubitOperator</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitHamiltonian</span><span class="o">.</span><span class="n">from_openfermion</span><span class="p">(</span><span class="n">of_operator</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">H</span><span class="p">),</span> <span class="n">H</span><span class="p">))</span>

<span class="c1"># initialization from file os often read in the string form</span>
<span class="n">of_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">of_operator</span><span class="p">)</span>
<span class="n">tq_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">of_string</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tq_string</span><span class="p">)</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitHamiltonian</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">of_string</span><span class="p">,</span> <span class="n">openfermion_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitHamiltonian</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="n">tq_string</span><span class="p">,</span> <span class="n">openfermion_format</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-compile-into-a-regular-function-instead-of-one-which-takes-dictionaries">
<h2>Can I compile into a regular function instead of one which takes dictionaries?<a class="headerlink" href="#can-i-compile-into-a-regular-function-instead-of-one-which-takes-dictionaries" title="Permalink to this headline">¶</a></h2>
<p>Not recommended but yes. The order of the function arguments is the
order you get from <code class="docutils literal notranslate"><span class="pre">extract_variables</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">power</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">QubitHamiltonian</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">&quot;X(0)Z(1)&quot;</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">compile_to_function</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;order is : &quot;</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}))</span>
</pre></div>
</div>
<p>If you also want to fix the samples and other entries to your compiled
objective you can build wrappers</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mywrapper</span><span class="p">(</span><span class="n">compiled_obj</span><span class="p">,</span> <span class="n">samples</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">x</span><span class="p">:</span> <span class="n">compiled_obj</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">)</span>

<span class="n">wrapped</span> <span class="o">=</span> <span class="n">mywrapper</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># don&#39;t expect same results, since samples are taken individually</span>
<span class="nb">print</span><span class="p">(</span><span class="n">wrapped</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> <span class="c1"># always takes 100 samples</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span> <span class="c1"># samples need to be given</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span> <span class="c1"># but sampling rate can be changed</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span> <span class="c1"># you can go back to full simulation which you cannot with the wrapped function</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-numerical-gradients-work">
<h2>How do numerical gradients work?<a class="headerlink" href="#how-do-numerical-gradients-work" title="Permalink to this headline">¶</a></h2>
<p>Yes this is possible by passing for example
<code class="docutils literal notranslate"><span class="pre">gradient={'method':'2-point',</span> <span class="pre">'stepsize':</span> <span class="pre">1.e-4}</span></code> to the
<code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code> function.</p>
<p>The default is a central 2-point derivative stencil where <code class="docutils literal notranslate"><span class="pre">h</span></code> is the
stepsize:</p>
<div class="math notranslate nohighlight">
\[\displaystyle
\frac{\partial f}{\partial a} = \frac{f(a+\frac{h}{2}) - f(a-\frac{h}{2})} {h}\]</div>
<p>Other methods are: <code class="docutils literal notranslate"><span class="pre">2-point-forward</span></code>: Forward derivative stencil:</p>
<div class="math notranslate nohighlight">
\[\displaystyle
\frac{\partial f}{\partial a} = \frac{f(a+h) - f(a)} {h}\]</div>
<p><code class="docutils literal notranslate"><span class="pre">2-point-backward</span></code>: Backward derivative stencil:</p>
<div class="math notranslate nohighlight">
\[\displaystyle
\frac{\partial f}{\partial a} = \frac{f(a) - f(a-h)} {h}\]</div>
<div class="line-block">
<div class="line">You can also use your own numerical derivative stencil by passing a
callable function as <code class="docutils literal notranslate"><span class="pre">method</span></code>.</div>
<div class="line">The function should have the signature which is given in the example
below.</div>
</div>
<p>Here is an example:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="c1"># form a simple example objective</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">)</span>

<span class="c1"># make it more interesting by using analytical gradients for the objective</span>
<span class="c1"># and numerical gradients to optimize it</span>

<span class="n">objective</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># integer multiples of pi/2 are minima</span>

<span class="c1"># start from the same point in all examples</span>
<span class="n">initial_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">2.3</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># optimize with analytical derivatives</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">objective</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">)</span>
<span class="c1">#result.history.plot(&quot;energies&quot;)</span>
<span class="c1">#result.history.plot(&quot;gradients&quot;)</span>

<span class="c1"># optimize with 2-point stencil</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="s1">&#39;2-point&#39;</span><span class="p">,</span> <span class="s1">&#39;stepsize&#39;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">)</span>
<span class="c1">#result.history.plot(&quot;energies&quot;)</span>
<span class="c1">#result.history.plot(&quot;gradients&quot;)</span>

<span class="c1"># optimize with custom stencil</span>
<span class="c1"># here this is the same as the default</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="k">def</span> <span class="nf">mymethod</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">angles</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">left</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">right</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">step</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="n">obj</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">mymethod</span><span class="p">,</span> <span class="s1">&#39;stepsize&#39;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">)</span>
<span class="c1">#result.history.plot(&quot;energies&quot;)</span>
<span class="c1">#result.history.plot(&quot;gradients&quot;)</span>

<span class="c1"># optimize with a scipy method and use scipys 2-point</span>
<span class="c1"># the scipy protocol will have more function evaluations and less gradient evaluations for some methods</span>
<span class="c1"># the stepsize in scipy has to be passed with the `method_options` dictionary</span>
<span class="c1"># with the keyword `eps`</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bfgs&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="s1">&#39;2-point&#39;</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span> <span class="n">initial_values</span><span class="o">=</span><span class="n">initial_values</span><span class="p">)</span>
<span class="c1">#result.history.plot(&quot;energies&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-use-the-numerical-gradient-protocols-from-scipy">
<h2>Can I use the numerical gradient protocols from SciPy?<a class="headerlink" href="#can-i-use-the-numerical-gradient-protocols-from-scipy" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Yes you can for all scipy methods by passing <code class="docutils literal notranslate"><span class="pre">gradient='2-point'</span></code> to
<code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code>.</div>
<div class="line">See the scipy documentation for the stepsize and more options which
can be passed with <code class="docutils literal notranslate"><span class="pre">method_options</span></code> dictionary where the key for the
stepsize is usually <code class="docutils literal notranslate"><span class="pre">eps</span></code>. Note that not all scipy methods support
numerical gradients,but cyou can always fall back to tequilas
numerical gradients. See the previous cell for an example.</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Matter Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>