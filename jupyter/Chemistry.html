<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tequila Chemistry Basics &#8212; tequila XXXXX documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Excited state calculation" href="ChemistryExcitedState.html" />
    <link rel="prev" title="Frequently Asked Questions:" href="FAQ.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Tequila</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href=".././tequila_presentation.html">Overview</a></li>
                <li><a href=".././install.html">Installation</a></li>
                <li><a href=".././package/index.html">API</a></li>
                <li><a href="https://github.com/aspuru-guzik-group/tequila">GitHub</a></li>
                <li><a href=".././tutorials.html">Tutorials</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Tequila</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantum-backends">Quantum Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantumchemistry">QuantumChemistry:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#troubleshooting">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../package/index.html">Tequila Library Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="FAQ.html" title="Previous Chapter: Frequently Asked Questions:"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Frequently As...</span>
    </a>
  </li>
  <li>
    <a href="ChemistryExcitedState.html" title="Next Chapter: Excited state calculation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Excited state... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/jupyter/Chemistry.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="tequila-chemistry-basics">
<h1>Tequila Chemistry Basics<a class="headerlink" href="#tequila-chemistry-basics" title="Permalink to this headline">¶</a></h1>
<div class="line-block">
<div class="line">Here we show the basics of the tequila chemistry module.</div>
<div class="line">In order for this to work you need to have psi4 installed in the same
python environment as tequila.</div>
<div class="line">If you are in a conda environment installing psi4 is easy:
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">psi4</span> <span class="pre">-c</span> <span class="pre">psi4</span></code></div>
<div class="line">But better check the <a class="reference external" href="http://www.psicode.org/">psi4 website</a> for up
to date instructions.</div>
</div>
<p>In some cases problems with the environment were observed which are
suspected to originate from conflicts between psi4 and tequila
dependcies. Usually the safest way is to install psi4 <strong>first</strong> and then
install tequila</p>
<p>Basic functionality is currently also provided with PySCF which might be
easier to install.</p>
<p>At the moment we only support closed-shell molecules</p>
<p>This tutorial will give an overview over:</p>
<ul class="simple">
<li><p>Initialization of molecules within tequila</p></li>
<li><p>Usage of different qubit encodings from openermion (JW, BK, BKSF,
Tapered-BK)</p></li>
<li><p>Using basic functionality of Psi4 with tequila</p></li>
<li><p>Setting up active spaces</p></li>
<li><p>Constructing UCC based quantum circuits with tequila</p></li>
</ul>
<p><strong>There might be issues with psi4 and jupyter, currently the workarround
is to reload the kernel before a cell gets executed, or run as a regular
python script</strong></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
</pre></div>
</div>
<div class="section" id="initialize-molecules">
<h2>Initialize Molecules<a class="headerlink" href="#initialize-molecules" title="Permalink to this headline">¶</a></h2>
<p>Molecules can be initialized by passing their geometries as string or
the name of a <code class="docutils literal notranslate"><span class="pre">xyz</span></code> file.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>

<span class="c1"># lets also print some information about the orbitals</span>
<span class="c1"># we need it later</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The Orbitals are:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">orbital</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">orbitals</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">orbital</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">You can initialize a tequila <code class="docutils literal notranslate"><span class="pre">QubitHamiltonian</span></code> from a molecule with
<code class="docutils literal notranslate"><span class="pre">make_hamiltonian</span></code>. The standard transformation is the
<code class="docutils literal notranslate"><span class="pre">jordan-wigner</span></code> transformation.</div>
<div class="line">You can use other transformations by initializing the molecule with
the <code class="docutils literal notranslate"><span class="pre">transformation</span></code> keyword.</div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="c1"># the LiH Hamiltonian is already quite large, better not print the full thing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hamiltonian has </span><span class="si">{}</span><span class="s2"> terms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="s2">&quot;bravyi-kitaev&quot;</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hamiltonian has </span><span class="si">{}</span><span class="s2"> terms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="using-different-qubit-encodings-of-openfermion">
<h2>Using different Qubit Encodings of OpenFermion<a class="headerlink" href="#using-different-qubit-encodings-of-openfermion" title="Permalink to this headline">¶</a></h2>
<p>The different qubit encodings of openfermion can be applied by passing
the keyword <code class="docutils literal notranslate"><span class="pre">transformation</span></code> to the molecule and setting it to the
name of the corresponding openfermion function.</p>
<p>Some of those transformation might require additional keywords.
Following <code class="docutils literal notranslate"><span class="pre">psi4</span></code> conventions those should be given to the <code class="docutils literal notranslate"><span class="pre">Molecule</span></code>
initialization with the prefix <code class="docutils literal notranslate"><span class="pre">transformation__</span></code>. For most of them,
<code class="docutils literal notranslate"><span class="pre">tequila</span></code> is however able to assign the keys automatically.</p>
<p>In the following we provide some examples using various transformations
from openfermion</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">geomstring</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">H 0.0 0.0 0.7&quot;</span>
<span class="n">basis_set</span> <span class="o">=</span> <span class="s2">&quot;sto-3g&quot;</span>

<span class="c1"># Jordan-Wigner (this is the default)</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">geomstring</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="s2">&quot;jordan_wigner&quot;</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Jordan-Wigner</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="n">eigenValues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lowest energy = &quot;</span><span class="p">,</span> <span class="n">eigenValues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Bravyi-Kitaev</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">geomstring</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span> <span class="n">transformation</span><span class="o">=</span><span class="s2">&quot;bravyi_kitaev&quot;</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bravyi-Kitaev</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="n">eigenValues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lowest energy = &quot;</span><span class="p">,</span> <span class="n">eigenValues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># symmetry_conserving_bravyi_kitaev</span>
<span class="c1"># this transformation will taper off two qubits of the Hamiltonian</span>
<span class="c1"># it needs additional information on the number of spin-orbitals and the active_fermions/electrons in the system</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="n">geomstring</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="n">basis_set</span><span class="p">,</span>
                              <span class="n">transformation</span><span class="o">=</span><span class="s2">&quot;symmetry_conserving_bravyi_kitaev&quot;</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetry conserving Bravyi-Kitaev</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="n">eigenValues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">to_matrix</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lowest energy = &quot;</span><span class="p">,</span> <span class="n">eigenValues</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Symmetry</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-active-spaces">
<h2>Setting active spaces<a class="headerlink" href="#setting-active-spaces" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">You can define active spaces on your molcule by passing down a
dictionary of active orbitals.</div>
<div class="line">The orbitals are grouped into the irreducible representation of the
underlying symmetry group (see the printout of <code class="docutils literal notranslate"><span class="pre">print(molecule)</span></code>
above).</div>
</div>
<p>Lets take the LiH molecule from above but initialize it with an active
space containing the second two A1 orbitals (meaning the first 0A1
orbital is frozen) and the B1 orbital</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hamiltonian has </span><span class="si">{}</span><span class="s2"> terms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
</pre></div>
</div>
<p>Lets make the active space even smaller, so that we can print out stuff
in this tutorial</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hamiltonian has </span><span class="si">{}</span><span class="s2"> terms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">H</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="computing-classical-methods-with-psi4">
<h2>Computing classical methods with Psi4<a class="headerlink" href="#computing-classical-methods-with-psi4" title="Permalink to this headline">¶</a></h2>
<p>We can use psi4 to compute the energies (and sometimes other quantities)
with the <code class="docutils literal notranslate"><span class="pre">compute_energy</span></code> function. Here are some examples. Note that
the energies are computed within the active space if one is set.</p>
<p>Note also that not all active spaces can be represented by psi4 which
will mean you can/should not use the classical psi4 methods with those
(a warning will be printed). You will still get the right active space
hamiltonian however.</p>
<p>Active spaces which will not work for psi4 methds are the ones where the
orbitals of individual irreps are not in one block ( e.g.
{<code class="docutils literal notranslate"><span class="pre">&quot;A1&quot;:[1,3]</span></code>} )</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOU MIGHT HAVE TO RESTART THE JUPYTER KERNEL</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;B2&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>

<span class="n">mp2</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;mp2&quot;</span><span class="p">)</span>

<span class="c1"># Note there are known issues for some methods when the active space as frozen virtuals as is the case here</span>
<span class="c1"># detci based methods are fine again</span>
<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>

<span class="c1"># for most coupled-cluster like models you can compute amplitudes</span>
<span class="c1"># Amplitudes are computed in c1 and in the full space, this is why the active space troubles from above usually don&#39;t hold</span>
<span class="c1"># Note that amplitudes are in closed-shell</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_amplitudes</span><span class="p">(</span><span class="s2">&quot;mp2&quot;</span><span class="p">)</span>

<span class="c1"># you can export a parameter dictionary which holds the indices of the amplitude as keys and values as values</span>
<span class="c1"># for this small active space that is only one amplitude for mp2</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="o">.</span><span class="n">make_parameter_dictionary</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>

<span class="c1"># similar for ccsd since the singles are 0 due to symmetry (that changes if you change the active space)</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_amplitudes</span><span class="p">(</span><span class="s2">&quot;ccsd&quot;</span><span class="p">)</span>
<span class="n">variables</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="o">.</span><span class="n">make_parameter_dictionary</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="hello-world-h2-optimization-with-lih-in-an-active-space">
<h2>Hello World “H2” optimization with LiH in an active space<a class="headerlink" href="#hello-world-h2-optimization-with-lih-in-an-active-space" title="Permalink to this headline">¶</a></h2>
<p>Lets do a small hand-constructed VQE like it would be done for the
Hydrogen molecule in STO-3G, just that we use our active space LiH
molecule from the cell above. For consistency reasons we initialize
everything again.</p>
<p>Check the <code class="docutils literal notranslate"><span class="pre">BasicUsage</span></code> and <code class="docutils literal notranslate"><span class="pre">SciPyOptimizers</span></code> tutorial notebooks for
more information about then</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="c1"># define the active space</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>

<span class="c1"># define the molecule</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>

<span class="c1"># make the hamiltonian</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>

<span class="c1"># define a hand designed circuit</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># define the expectationvalue</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># optimize</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">E</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">()})</span>

<span class="c1"># compute a reference value with psi4</span>
<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FCI : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fci</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># some more information from the optimization</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;energies&quot;</span><span class="p">,</span> <span class="n">baselines</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fci&quot;</span><span class="p">:</span><span class="n">fci</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="unitary-coupled-cluster-style-construction">
<h2>Unitary Coupled-Cluster Style Construction<a class="headerlink" href="#unitary-coupled-cluster-style-construction" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">Here we show how to initialize in the style of unitary
coupled-cluster.</div>
<div class="line">In this example we are gonna compute the <code class="docutils literal notranslate"><span class="pre">mp2</span></code> amplitudes and build
a UCC type circuit from them.</div>
<div class="line">Here we use the cc2 amplitudes only to define an order on the
trotterized gates and remove small amplitudes as classical
prescreening.</div>
</div>
<p>We use again an active space to make the computation fast.</p>
<p>First we start with the manual construction and then show how to use in
build convenience functions of tequila to.</p>
<div class="line-block">
<div class="line">An important function is the <code class="docutils literal notranslate"><span class="pre">make_excitation_generator</span></code> function of
the molecule.</div>
<div class="line">This initializes a <code class="docutils literal notranslate"><span class="pre">QubitHamiltonian</span></code> which can be used to define a
unitary gate which acts as excitation operation of electrons.</div>
</div>
<div class="math notranslate nohighlight">
\[\displaystyle
U(\theta) = e^{-i\frac{\theta}{2} G_{iajbkc\dots}}\]</div>
<p>In fermionic language the generator is defined as</p>
<div class="math notranslate nohighlight">
\[G_{ia,jb,jc,\dots} =  i ( a^\dagger_a a_i a^\dagger_b a_j a^\dagger_c a_k \dots - h.c. )\]</div>
<p>The <code class="docutils literal notranslate"><span class="pre">make_excitation_generator</span></code> function gives back this generator in
the qubit representation (depends on the chosen <code class="docutils literal notranslate"><span class="pre">transformation</span></code> of
the molecule) and takes the indices as list of tuples</p>
<div class="math notranslate nohighlight">
\[\text{make_excitation_generator(indices=[(a,i),(b,j),...])} = G_{ia,jb,jc,\dots}\]</div>
<div class="section" id="manual-construction">
<h3>Manual Construction<a class="headerlink" href="#manual-construction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOU MIGHT HAVE TO RESTART THE JUPYTER KERNEL</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.e-6</span>

<span class="c1"># define the active space</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>

<span class="c1"># define the molecule</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>

<span class="c1"># make the hamiltonian</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>

<span class="c1"># compute classical amplitudes</span>
<span class="n">amplitudes</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_amplitudes</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;mp2&quot;</span><span class="p">)</span>

<span class="c1"># in this example there is only one closed-shell MP2 amplitude, therefore manual construction is reasonable in this tutorial</span>
<span class="c1"># first we make a dictionary out of the non-zero MP2 amplitudes</span>
<span class="n">ampdict</span> <span class="o">=</span> <span class="n">amplitudes</span><span class="o">.</span><span class="n">make_parameter_dictionary</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ampdict</span><span class="p">)</span>
<span class="c1"># lets get the indices of the only amplitude which is there manually</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ampdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># the (1, 0, 1, 0) index in closed shell leads to the (2, 0, 3, 1) and (3, 1, 2, 0) excitations on the qubits</span>
<span class="c1"># but first we need to initialize the hartree fock state</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">prepare_reference</span><span class="p">()</span>

<span class="c1"># now add the two 2-electron excitations</span>
<span class="c1"># for this we define the generators and build trotterized gates with them</span>
<span class="c1"># note that the two generators are actually the same</span>
<span class="c1"># we sum them up since we want to parametrize them with the same variable which we will call &quot;a&quot;</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_excitation_generator</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span> <span class="o">+</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_excitation_generator</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Trotterized</span><span class="p">(</span><span class="n">generators</span><span class="o">=</span><span class="p">[</span><span class="n">generator</span><span class="p">],</span> <span class="n">angles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">],</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># define the expectationvalue</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># optimize</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">E</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">()})</span>

<span class="c1"># compute a reference value with psi4</span>
<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FCI : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fci</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="automatic-construction">
<h3>Automatic Construction<a class="headerlink" href="#automatic-construction" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOU MIGHT HAVE TO RESTART THE JUPYTER KERNEL</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.e-6</span>

<span class="c1"># define the active space</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>

<span class="c1"># define the molecule</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">)</span>

<span class="c1"># make the hamiltonian</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>

<span class="c1"># make the UCCSD ansatz (note that this will be without singles since it starts from mp2)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_uccsd_ansatz</span><span class="p">(</span><span class="n">initial_amplitudes</span><span class="o">=</span><span class="s2">&quot;mp2&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">trotter_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># define the expectationvalue</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># optimize</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">E</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">()})</span>

<span class="c1"># compute a reference value with psi4</span>
<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FCI : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fci</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="pi-system-of-benzene">
<h3>Pi System of Benzene<a class="headerlink" href="#pi-system-of-benzene" title="Permalink to this headline">¶</a></h3>
<p>Lets repeat the last cell with the pi system of the benzene molecule</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># YOU MIGHT HAVE TO RESTART THE JUPYTER KERNEL</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.e-6</span>
<span class="n">active</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;B1u&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;B3g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B2g&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Au&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;b1u&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">quantumchemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;data/benzene.xyz&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s1">&#39;sto-3g&#39;</span><span class="p">,</span> <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>

<span class="c1"># make the UCCSD ansatz</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_uccsd_ansatz</span><span class="p">(</span><span class="n">initial_amplitudes</span><span class="o">=</span><span class="s2">&quot;cc2&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">trotter_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># define the expectationvalue</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">)</span>

<span class="c1"># compute reference energies</span>
<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>
<span class="n">cisd</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="s2">&quot;detci&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;detci__ex_level&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

<span class="c1"># optimize</span>
<span class="c1"># Scipy either `eps` (version &lt;1.5) or &#39;finite_diff_rel_step&#39; (verion &gt; 1.5)</span>
<span class="c1"># for the 2-point stencil</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;BFGS&quot;</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="s2">&quot;2-point&quot;</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">,</span> <span class="s2">&quot;finite_diff_rel_step&quot;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">,</span> <span class="s2">&quot;gtol&quot;</span><span class="p">:</span> <span class="mf">1.e-3</span><span class="p">},</span> <span class="n">initial_values</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">E</span><span class="o">.</span><span class="n">extract_variables</span><span class="p">()})</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CISD: </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cisd</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FCI : </span><span class="si">{:+2.8}</span><span class="s2">f&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fci</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s2">&quot;energies&quot;</span><span class="p">,</span> <span class="n">baselines</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fci&quot;</span><span class="p">:</span><span class="n">fci</span><span class="p">,</span> <span class="s2">&quot;cisd&quot;</span><span class="p">:</span> <span class="n">cisd</span><span class="p">},</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;benzene_result_bfgs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="noisy-optimization-of-an-active-space-molecule-with-tapered-qubit-embeding">
<h2>Noisy optimization of an active space molecule with tapered qubit embeding<a class="headerlink" href="#noisy-optimization-of-an-active-space-molecule-with-tapered-qubit-embeding" title="Permalink to this headline">¶</a></h2>
<p>This example shows the combination of several features of tequila in a
few lines</p>
<ul class="simple">
<li><p>automatic handling of active spaces</p></li>
<li><p>consitent usage of qubit encodings (here the
symmetry_conserving_bravyi_kitaev encoding from openfermion which
reduces the number of qubits by 2)</p></li>
<li><p>custom circuit construction</p></li>
<li><p>unitary cluster circuits</p></li>
<li><p>optimization of measurements (here the Hamiltonian will be grouped
into two commuting groups, this can be seen by the optimizer output
which holds two expectation values). See the
<a class="reference external" href="https://github.com/aspuru-guzik-group/tequila/blob/master/tutorials/MeasurementGroups.ipynb">MeasurementGroups</a>
tutorial for more background information.</p></li>
<li><p>interface to different quantum backends (you will need qiskit to run
this cell)</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="c1"># define the active space</span>
<span class="n">active_orbitals</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;A1&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;B1&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">]}</span>
<span class="n">samples</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">backend</span> <span class="o">=</span> <span class="s2">&quot;qiskit&quot;</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;fake_rome&quot;</span>
<span class="c1"># define the molecule</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">chemistry</span><span class="o">.</span><span class="n">Molecule</span><span class="p">(</span><span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;H 0.0 0.0 0.0</span><span class="se">\n</span><span class="s2">Li 0.0 0.0 1.6&quot;</span><span class="p">,</span>
                                 <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;sto-3g&quot;</span><span class="p">,</span>
                                 <span class="n">active_orbitals</span><span class="o">=</span><span class="n">active_orbitals</span><span class="p">,</span>
                                 <span class="n">transformation</span><span class="o">=</span><span class="s2">&quot;symmetry_conserving_bravyi_kitaev&quot;</span><span class="p">)</span>

<span class="n">fci</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">(</span><span class="s2">&quot;fci&quot;</span><span class="p">)</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_hamiltonian</span><span class="p">()</span>

<span class="c1"># Toy circuit (no deeper meaning)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">optimize_measurements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">vqe</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">noisy_vqe</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># The same with UpCCGSD</span>
<span class="n">UpCCGSD</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">make_upccgsd_ansatz</span><span class="p">(</span><span class="n">include_singles</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">E2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">UpCCGSD</span><span class="p">,</span> <span class="n">optimize_measurements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ucc</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">E2</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">noisy_ucc</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span> <span class="n">objective</span><span class="o">=</span><span class="n">E2</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>  <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE         = </span><span class="si">{:2.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">vqe</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE (noisy) = </span><span class="si">{:2.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">noisy_vqe</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UCC         = </span><span class="si">{:2.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ucc</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UCC (noisy) = </span><span class="si">{:2.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">noisy_ucc</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># repeat printout</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE         = </span><span class="si">{:2.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">vqe</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VQE (noisy) = </span><span class="si">{:2.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">noisy_vqe</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UCC         = </span><span class="si">{:2.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ucc</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;UCC (noisy) = </span><span class="si">{:2.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">noisy_ucc</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">energies</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Matter Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>