<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optimization &#8212; tequila XXXXX documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tequila Tutorial:" href="SciPyOptimizers.html" />
    <link rel="prev" title="Basis Set Free VQE calculations with Tequila" href="ChemistryBasisSetFreeVQE.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Tequila</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href=".././tequila_presentation.html">Overview</a></li>
                <li><a href=".././install.html">Installation</a></li>
                <li><a href=".././package/index.html">API</a></li>
                <li><a href="https://github.com/aspuru-guzik-group/tequila">GitHub</a></li>
                <li><a href=".././tutorials.html">Tutorials</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Tequila</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantum-backends">Quantum Backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#quantumchemistry">QuantumChemistry:</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#dependencies">Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#troubleshooting">Troubleshooting</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../package/index.html">Tequila Library Reference</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="ChemistryBasisSetFreeVQE.html" title="Previous Chapter: Basis Set Free VQE calculations with Tequila"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Basis Set Fre...</span>
    </a>
  </li>
  <li>
    <a href="SciPyOptimizers.html" title="Next Chapter: Tequila Tutorial:"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tequila Tutorial: &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/jupyter/Optimizer_Tutorial.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="optimization">
<h1>Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline">¶</a></h1>
<p>Hello, and welcome to our tutorial on optimization. Here, we will
explore the four different optimizers which already have <code class="docutils literal notranslate"><span class="pre">Tequila</span></code>
interfaces: a native GD optimizer, alongside interfaces for <code class="docutils literal notranslate"><span class="pre">SciPy</span></code>,
<code class="docutils literal notranslate"><span class="pre">GPyOpt</span></code>, and <code class="docutils literal notranslate"><span class="pre">Phoenics</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### start at the start: import statements!</span>
<span class="kn">import</span> <span class="nn">tequila</span> <span class="k">as</span> <span class="nn">tq</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p><strong>How to optimize an ``Objective``:</strong></p>
<p>In <code class="docutils literal notranslate"><span class="pre">tequila</span></code>, optimizers are accessed in several ways. They may be
instantiated as objects directly, which can then be called; they are
also accessible through <code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code>. Either of these methods have an
obligatory argument: an <code class="docutils literal notranslate"><span class="pre">Objective</span></code>. <code class="docutils literal notranslate"><span class="pre">tq.minimize</span></code> also requires you
supply a <code class="docutils literal notranslate"><span class="pre">method</span></code>, which must be a string; the call methods of the GD,
<code class="docutils literal notranslate"><span class="pre">SciPy</span></code>, and <code class="docutils literal notranslate"><span class="pre">GPyOpt</span></code> optimizers accept this key as well.</p>
<p>As keywords to any optimization call, you can pass down the usual
compilation kwargs for quantum simulation in <code class="docutils literal notranslate"><span class="pre">Tequila</span></code>: *
<code class="docutils literal notranslate"><span class="pre">backend</span></code>, a string indicating which quantum simulator to use *
<code class="docutils literal notranslate"><span class="pre">samples</span></code>, an int indicating how many shots of the circuit to measure
(None means full wf simulation) * <code class="docutils literal notranslate"><span class="pre">device</span></code>, (generally) a string
indicating which (real or emulated) quantum computer to sample from
(requires samples be specified), * <code class="docutils literal notranslate"><span class="pre">noise</span></code>, the NoiseModel object to
apply to the circuits simulated (see the tutorial on noise).</p>
<p>additional keywords you might use include: * <code class="docutils literal notranslate"><span class="pre">variables</span></code>, a <code class="docutils literal notranslate"><span class="pre">list</span></code>
of the <code class="docutils literal notranslate"><span class="pre">Variable</span></code>s you want to optimize (the default is all of
them). * <code class="docutils literal notranslate"><span class="pre">initial_values</span></code>, which gives a start point to optimization.
If you supply arguments to <code class="docutils literal notranslate"><span class="pre">variables</span></code>, you also need to supply
arguments to <code class="docutils literal notranslate"><span class="pre">initial_values</span></code> so that all non-optimized parameters
have a value to use. The default is random initialization (not
recomended) * <code class="docutils literal notranslate"><span class="pre">gradient</span></code>, which specifies which type of gradient will
be used : analytical gradients (Default): gradient=None, numerical
gradients: gradient={‘method’:’2-point’, “stepsize”:1.e-4}, custom
gradient objectives: gradient={tq.Variable:tq.Objective}, module
specific gradients: gradient=”2-point” (to use for example <code class="docutils literal notranslate"><span class="pre">SciPy</span></code>
finite difference stencils). * <code class="docutils literal notranslate"><span class="pre">silent</span></code>, silence outputs</p>
<p>Some of the optimizers take more, or different, keywords from the
others, so check the documentation for each one. In case the optimizer
has some degree of verbosity (currently, they all do), you can
deactivate this with <code class="docutils literal notranslate"><span class="pre">silent=True</span></code>.</p>
<p>The following optimization methods are available on your system in
<code class="docutils literal notranslate"><span class="pre">Tequila</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">show_available_optimizers</span><span class="p">()</span>
</pre></div>
</div>
<p>We will use two different <code class="docutils literal notranslate"><span class="pre">Objective</span></code>s for optimization in this
tutorial. The first of these is a two qubit expectation value with the
tractable but non trivial hamiltonian <span class="math notranslate nohighlight">\([Y(0)+Qm(0)]\otimes X(1)\)</span>,
where <span class="math notranslate nohighlight">\(Qm=\frac{1}{2} (I - Z)\)</span>, the projector onto the |1&gt; state.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### optimizing the circuit in terms of pi makes the result of the optimization easier to interpret.</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span>

<span class="n">U1</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">H</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
<span class="n">U1</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1">### once we have a circuit, we pick a hamiltonian to optimize over</span>
<span class="n">H1</span><span class="o">=</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Qm</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">O1</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">U</span><span class="o">=</span><span class="n">U1</span><span class="p">,</span><span class="n">H</span><span class="o">=</span><span class="n">H1</span><span class="p">)</span>

<span class="c1">### we use the .draw function to pretty-print circuits via backend printers.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We will optimize the following objective: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">O1</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;qiskit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our second <code class="docutils literal notranslate"><span class="pre">Objective</span></code>, O2, will measure a 3-qubit circuit with
respect to the Hamiltonian <span class="math notranslate nohighlight">\(Y(0)\otimes X(1) \otimes Y(2)\)</span></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### this time, don&#39;t scale by pi</span>

<span class="n">H2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">tq</span><span class="o">.</span><span class="n">paulis</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">U2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="n">tq</span><span class="o">.</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">U2</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rz</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">U2</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">control</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">U2</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Ry</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">Rx</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">U2</span> <span class="o">+=</span> <span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">control</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">tq</span><span class="o">.</span><span class="n">gates</span><span class="o">.</span><span class="n">CNOT</span><span class="p">(</span><span class="n">control</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">O2</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">ExpectationValue</span><span class="p">(</span><span class="n">H</span><span class="o">=</span><span class="n">H2</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We will optimize the following objective: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">O2</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;qiskit&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="local-optimizers">
<h2>Local Optimizers<a class="headerlink" href="#local-optimizers" title="Permalink to this headline">¶</a></h2>
<p>We will begin this tutorial by focusing on local optimizers. By local
optimization, we mean the any optimization schema where the suggested
parameters at step t are always a transformation of the parameters
suggested at step t-1. This includes a large number of the standard
optimization techniques in use today, like gradient descent. <code class="docutils literal notranslate"><span class="pre">Tequila</span></code>
comes with two local optimizers: a native gradient descent optimizer,
implementing a number of the most popular gradient descent algorithms
used in classical machine learning, as well as a plugin for the
<code class="docutils literal notranslate"><span class="pre">SciPy</span></code> package (which is installed alongside <code class="docutils literal notranslate"><span class="pre">Tequila</span></code>), which
allows the use of a number of gradient-free, gradient-based, and
hessian-based optimization methods.</p>
<div class="section" id="the-gd-optimizer">
<h3>The GD Optimizer<a class="headerlink" href="#the-gd-optimizer" title="Permalink to this headline">¶</a></h3>
<p>we will start this tutorial by looking at the GD optimizer. Here is an
overview over the available optimization methods.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">show_available_optimizers</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;gd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As one sees, a variety of methods are available for optimization. Here,
‘sgd’ refers to the standard gradient descent algorithm, without
momentum. like all tequila optimizers, the GD optimizer has a minimize
function and most of the arguments are the same. However, there is one
important difference: the GD optimizer takes a learning rate, lr. This
parameter mediates step size in all of the GD optimizer methods; it is a
positive float which scales the step in the direction of the gradient.</p>
<p>We will now optimize O1, our two-qubit expectation value, choosing
starting angles equivalent to <span class="math notranslate nohighlight">\(\frac{1}{4}\pi\)</span> for all four
variables, and optimizing via the
<a class="reference external" href="https://towardsdatascience.com/_adam-latest-trends-in-deep-learning-optimization-6be9a291375c">‘Adam’</a>
method.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span>

<span class="c1">### For even more fun, try using sampling with the samples keyword,</span>
<span class="c1">### or pick your favorite backend with the &#39;backend&#39; keyword!</span>

<span class="n">adam_result</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
              <span class="n">maxiter</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
              <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
              <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The plots below show the trajectory of both the value of the objective
and the values of the angles as a function of time.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adam_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">adam_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">adam_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">adam_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>We see that, minus a few hiccups, all the angles converge to optimimum
values.</strong></p>
<p><strong>Let’s repeat what we did above, but with a few of the other methods!
Here’s RMSprop:</strong></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">rms_result</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;rmsprop&#39;</span><span class="p">,</span>
              <span class="n">maxiter</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
              <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
              <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSprop optimization results:&#39;</span><span class="p">)</span>
<span class="n">rms_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">rms_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">rms_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">rms_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>… And here’s Momentum:</strong></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">mom_result</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;momentum&#39;</span><span class="p">,</span>
              <span class="n">maxiter</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
              <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
              <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;momentum optimization results:&#39;</span><span class="p">)</span>
<span class="n">mom_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">mom_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">mom_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">mom_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that when using the
<a class="reference external" href="https://towardsdatascience.com/understanding-rmsprop-faster-neural-network-learning-62e116fcf29a">RMSprop</a>
method, we reduced the learning rate from 0.1 to 0.01. Different methods
may be more or less sensitive to choices of initial learning rate. Try
going back to the previous examples, and choosing different learning
rates, or different initial parameters, to gain a feel for how sensitive
different methods are.</p>
<p><strong>The GD optimizer, with the Quantum Natural Gradient:</strong></p>
<p>The Quantum Natural Gradient, or QNG, is a novel method of calculating
gradients for quantum systems, inspired by the natural gradient
sometimes employed in classical machine learning. The usual gradient we
employ is with respect to a euclidean manifold, but this is not the only
geometry – nor even, the optimal geometry – of quantum space. The QNG
is, in essence, a method of taking gradients with respect to (an
approximation to) the Fubini-Study metric. For information on how (and
why) the QNG is used, see <a class="reference external" href="https://arxiv.org/abs/1909.02108">Stokes
et.al</a>.</p>
<p>Using the qng in Tequila is as simple as passing in the keyword
gradient=’qng’ to optimizers which support it, such as the GD optimizer.
We will use it to optimize O2, our 3 qubit <code class="docutils literal notranslate"><span class="pre">Objective</span></code>, and then
compare the results to optimizing the same circuit with the regular
gradient.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### the keyword stop_count, below, stops optimization if no improvement occurs after 50 epochs.</span>
<span class="c1">### let&#39;s use a random initial starting point:</span>
<span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">]}</span>

<span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">qng_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="s1">&#39;qng&#39;</span><span class="p">,</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">qng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with qng: &#39;</span><span class="p">,</span><span class="n">qng_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with qng: &#39;</span><span class="p">,</span><span class="n">qng_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p>To gain appreciation for why one might use the QNG, let’s optimize the
same circuit with the same learning rate and the same method, but
without QNG.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">sgd_noqng_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting what happens without QNG&#39;</span><span class="p">)</span>
<span class="n">sgd_noqng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">sgd_noqng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy without qng: &#39;</span><span class="p">,</span><span class="n">sgd_noqng_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles without qng: &#39;</span><span class="p">,</span><span class="n">sgd_noqng_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p>Though the starting point was random you will most likely see that the
QNG run achieved a greater degree of improvement – it will not perform
worse –, and that the trajectories followed by angles there were
different from those followed by angles in the sgd-only optimization.
Feel free to play around with other methods, learning rates, or circuits
in the space below!</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### Use this space to optimize your own circuits!</span>
</pre></div>
</div>
</div>
<div class="section" id="the-scipy-optimizer">
<h3>The SciPy Optimizer<a class="headerlink" href="#the-scipy-optimizer" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">SciPy</span></code> is one of the most popular optimization packages in
<code class="docutils literal notranslate"><span class="pre">Python</span></code>. It offers a wide variety of optimization strategies. We will
not cover them here; for a full exploration of all the <code class="docutils literal notranslate"><span class="pre">SciPy</span></code>
methods, see <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">their
docs</a>.
Here, we will exhibit a few of the more powerful options available. Most
<code class="docutils literal notranslate"><span class="pre">SciPy</span></code> keywords like <code class="docutils literal notranslate"><span class="pre">method_options</span></code> can just be passed to
<code class="docutils literal notranslate"><span class="pre">minimize</span></code> directly in the same way as when using <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> directly.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tq</span><span class="o">.</span><span class="n">show_available_optimizers</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="s2">&quot;scipy&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We will try three different optimizers: <code class="docutils literal notranslate"><span class="pre">COBYLA</span></code>, which is
gradient-free, <code class="docutils literal notranslate"><span class="pre">L-BFGS-B</span></code>, which employs gradients, and <code class="docutils literal notranslate"><span class="pre">NEWTON-CG</span></code>,
which employs the Hessian.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;As a reminder: we will optimize:&#39;</span><span class="p">)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">O1</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;qiskit&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>

<span class="n">cobyla_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cobyla&quot;</span><span class="p">,</span>
                            <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                            <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">},</span>
                            <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">cobyla_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">cobyla_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with cobyla: &#39;</span><span class="p">,</span><span class="n">cobyla_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with cobyla: &#39;</span><span class="p">,</span><span class="n">cobyla_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lb_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;l-bfgs-b&quot;</span><span class="p">,</span>
                            <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                            <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">},</span>
                            <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">lb_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">lb_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with L-BFGS-B: &#39;</span><span class="p">,</span><span class="n">lb_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with L-BFGS-B: &#39;</span><span class="p">,</span><span class="n">lb_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">newton_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;newton-cg&quot;</span><span class="p">,</span>
                            <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                            <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">},</span>
                            <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">newton_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">newton_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with NEWTON-CG: &#39;</span><span class="p">,</span><span class="n">newton_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with NEWTON-CG: &#39;</span><span class="p">,</span><span class="n">newton_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p>All three of the methods converged to the same minimum, but not
necessarily to the same angles; the gradient and hessian based methods
converged to approximately the same angles in similar time.</p>
<p><strong>Scipy Extras: numerical gradients and Hessians</strong> Scipy allows for the
use of numerical gradients. To use them, pass down keywords to the
<code class="docutils literal notranslate"><span class="pre">gradient</span></code> argument, like <code class="docutils literal notranslate"><span class="pre">'2-point'</span></code>. When using the numerical
gradients of <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> it is often crucial to determine a feasible
stepsize for the procedure. This can be done with the <code class="docutils literal notranslate"><span class="pre">method_options</span></code>
entry <code class="docutils literal notranslate"><span class="pre">finite_diff_rel_step</span></code> (for <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> version 1.5 or higher) or
<code class="docutils literal notranslate"><span class="pre">eps</span></code> (for <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> version &lt; 1.5).</p>
<p>Here is one example. <strong>Please check your SciPy version!</strong></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lb_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;l-bfgs-b&quot;</span><span class="p">,</span>
                            <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
                            <span class="n">gradient</span><span class="o">=</span><span class="s2">&quot;2-point&quot;</span><span class="p">,</span>
                            <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="n">method_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;gtol&quot;</span><span class="p">:</span><span class="mf">1.e-3</span><span class="p">,</span> <span class="s2">&quot;finite_diff_rel_step&quot;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span> <span class="c1"># eps for scipy version &lt; 1.5</span>
                            <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">lb_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">lb_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with L-BFGS-B: &#39;</span><span class="p">,</span><span class="n">lb_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with L-BFGS-B: &#39;</span><span class="p">,</span><span class="n">lb_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Scipy Extras: the QNG in SciPy</strong> Scipy is also configured to use the
qng, just as the gd optimizer is. All one needs to do is set
<code class="docutils literal notranslate"><span class="pre">gradient=qng</span></code>. Let’s See how QNG interacts with the <code class="docutils literal notranslate"><span class="pre">BFGS</span></code>
optimizer. We will use 02, our 3-qubit expectationvalue, that we used
previously.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">]}</span>
<span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">bfgs_qng_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="s1">&#39;qng&#39;</span><span class="p">,</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting what happens with QNG&#39;</span><span class="p">)</span>
<span class="n">bfgs_qng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">bfgs_qng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy with qng: &#39;</span><span class="p">,</span><span class="n">bfgs_qng_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles with qng: &#39;</span><span class="p">,</span><span class="n">bfgs_qng_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bfgs_noqng_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting what happens without QNG&#39;</span><span class="p">)</span>
<span class="n">bfgs_noqng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">bfgs_noqng_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy without qng: &#39;</span><span class="p">,</span><span class="n">bfgs_noqng_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles without qng: &#39;</span><span class="p">,</span><span class="n">bfgs_noqng_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="numerical-and-customized-gradients">
<h2>Numerical and Customized Gradients<a class="headerlink" href="#numerical-and-customized-gradients" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">By default <code class="docutils literal notranslate"><span class="pre">tequila</span></code> compiles analytical gradients of the objectives
using <code class="docutils literal notranslate"><span class="pre">jax</span></code>, internal recompilation and the parameter shift rule.
The default is not setting the <code class="docutils literal notranslate"><span class="pre">gradient</span></code> keyword or setting it to
<code class="docutils literal notranslate"><span class="pre">None</span></code>. The keyword can also be set to a dictionary (keys are the
variables, values are the <code class="docutils literal notranslate"><span class="pre">tequila</span></code> objectives which are assumed to
evaluate to the corresponding gradients of the objective).</div>
<div class="line">For example <code class="docutils literal notranslate"><span class="pre">gradient=tq.grad(objective)</span></code> will results have the same
results as <code class="docutils literal notranslate"><span class="pre">gradient=None</span></code> or simply not setting it.</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tequila</span></code> offers its own way of compiling numerical gradients which
can then be used troughout all gradient based optimizers. It can be
activated by setting <code class="docutils literal notranslate"><span class="pre">gradient</span></code> to a dictionary holding the finite
difference stencil as <code class="docutils literal notranslate"><span class="pre">method</span></code> as well as the <code class="docutils literal notranslate"><span class="pre">stepsize</span></code>.</p>
<p>Numerical gradients of that type come with the cost of
2*<code class="docutils literal notranslate"><span class="pre">len(variables)</span></code> and can lead to significantly cheaper gradients,
especially if many expectation values are involved in the objective
and/or if heavy recompilation of parametrized gates is necessary. Here
is a small example using our <code class="docutils literal notranslate"><span class="pre">O2</span></code> objective, here the numerical
2-point procedure leads to 4 expectation values in the gradients (while
anayltial gradients would lead to 8, set silent to False in the upper
example or remove the gradient statement here).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">num_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;2-point&quot;</span><span class="p">,</span> <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tequila</span></code> currently offers <code class="docutils literal notranslate"><span class="pre">2-point</span></code> as well as <code class="docutils literal notranslate"><span class="pre">2-point-forward</span></code>
and <code class="docutils literal notranslate"><span class="pre">2-point-backward</span></code> stencils as <code class="docutils literal notranslate"><span class="pre">method</span></code>. The method can also be
set to a python function performing the task. Here is an example which
implements the same as <code class="docutils literal notranslate"><span class="pre">2-point</span></code>. The function can be replaced by any
function with the same signature.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="k">def</span> <span class="nf">my_finite_difference_stencil</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">var_vals</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculate objective gradient by symmetric shifts about a point.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj: Objective:</span>
<span class="sd">            objective to call.</span>
<span class="sd">        var_vals:</span>
<span class="sd">            variables to feed to the objective.</span>
<span class="sd">        key:</span>
<span class="sd">            which variable to shift, i.e, which variable&#39;s gradient is being called.</span>
<span class="sd">        step:</span>
<span class="sd">            the size of the shift; a small float.</span>
<span class="sd">        args</span>
<span class="sd">        kwargs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float:</span>
<span class="sd">            the approximated gradient of obj w.r.t variable key at point var_vals[key] as a float.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">var_vals</span><span class="p">)</span>
        <span class="n">left</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">var_vals</span><span class="p">)</span>
        <span class="n">right</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">step</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-</span> <span class="n">obj</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

<span class="n">num_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span>
                     <span class="n">gradient</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="n">my_finite_difference_stencil</span><span class="p">,</span> <span class="s2">&quot;stepsize&quot;</span><span class="p">:</span><span class="mf">1.e-4</span><span class="p">},</span>
                     <span class="n">method</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">num_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gradient</span></code> keyword can also be replaced by a dictionary of
<code class="docutils literal notranslate"><span class="pre">tequila</span></code> objectives which evaluate to gradients approximations of it.</p>
</div>
<div class="section" id="bayesian-optimization">
<h2>Bayesian optimization<a class="headerlink" href="#bayesian-optimization" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://arxiv.org/abs/1807.02811">Bayesian optimization</a> is a method
of global optimization, often used to tune hyperparameters in classical
learning. It has also seen use in the optimization of <a class="reference external" href="https://arxiv.org/pdf/1812.08862.pdf">quantum
circuits</a>. Tequila currently
supports 2 different bayesian optimization algorithms:
<a class="reference external" href="https://github.com/aspuru-guzik-group/phoenics">Phoenics</a> and
<a class="reference external" href="https://github.com/SheffieldML/GPyOpt">GPyOpt</a>, optimizers
originally developed for optimizing expensive experimental procedures in
chemistry. Click the links to get to the respective github pages, and
download the optimizers before continuing this tutorial.</p>
<div class="section" id="gpyopt">
<h3>GPyOpt<a class="headerlink" href="#gpyopt" title="Permalink to this headline">¶</a></h3>
<p>GPyOpt can be used like any of our other optimizers. Like the GD and
SciPy optimizers, it also takes a ‘method’ keyword. 3 methods are
supported: <code class="docutils literal notranslate"><span class="pre">'lbfgs'</span></code>,<code class="docutils literal notranslate"><span class="pre">'DIRECT'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'CMA'</span></code>. See the <code class="docutils literal notranslate"><span class="pre">GPyOpt</span></code>
github for more info.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;As a reminder, we will optimize&#39;</span><span class="p">)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">O1</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;qiskit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### let&#39;s use the lbfgs method.</span>
<span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="c1">### note: no lr is passed here! there are fewer tunable keywords for this optimizer.</span>
<span class="n">result</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
              <span class="n">maxiter</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
              <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GPyOpt optimization results:&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Don’t worry, the plot’s not broken!</strong> Perhaps you are looking at the
plots above in horror. But, do take note: bayesian optimization is a
global, exploratory optimization method, designed to explore large
portions of parameter space while still seeking out optimality. Look at
the optimal energy again, and one sees that the best performance of this
optimization method matched that of all the gradient descent methods. We
will apply gpyopt, next, to the QNG example circuit above, and see how
bayesian optimization compares to QNG and SGD.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hey, remember me?&#39;</span><span class="p">)</span>
<span class="n">tq</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">O2</span><span class="p">)</span>
<span class="c1">### the keyword stop_count, below, stops optimization if no improvement occurs after 50 epochs.</span>
<span class="c1">### let&#39;s use a random initial starting point:</span>
<span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">]}</span>

<span class="n">gpy_result</span> <span class="o">=</span> <span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O2</span><span class="p">,</span><span class="n">maxiter</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
                     <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="n">gpy_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">gpy_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">gpy_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>In a very, very small number of steps, GPyOpt is able to match the
performance of SGD with the QNG.</strong></p>
<p><strong>There’s a few extras you can access if you are well-familiar with
GPyOpt.</strong> We return as part of <code class="docutils literal notranslate"><span class="pre">result</span></code> an attribute
<code class="docutils literal notranslate"><span class="pre">result.gpyopt_instance</span></code>, which is an instance of the native
<code class="docutils literal notranslate"><span class="pre">GPyOpt</span></code> <code class="docutils literal notranslate"><span class="pre">BayesianOptimization</span></code> object – the one built and run
during your optimization. It has some plotting features you can use.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span><span class="o">=</span><span class="n">gpy_result</span><span class="o">.</span><span class="n">gpyopt_instance</span>
<span class="n">obj</span><span class="o">.</span><span class="n">plot_convergence</span><span class="p">()</span>
</pre></div>
</div>
<p>If your function has 1 or 2 parameters (but no more) you can also see a
plot of its acquisition function! see
<a class="reference external" href="https://www.blopig.com/blog/2019/10/a-gentle-introduction-to-the-gpyopt-module/">here</a>
for more info!</p>
<p>You can also extract the acquisition function of the model itself, and
play with it (it takes ones object, an np array, as input), using:</p>
<p><code class="docutils literal notranslate"><span class="pre">acq=result.gpyopt_instance.acquisition.acquisition_function</span></code></p>
</div>
<div class="section" id="phoenics">
<h3>Phoenics<a class="headerlink" href="#phoenics" title="Permalink to this headline">¶</a></h3>
<p>Finally, we turn to
<code class="docutils literal notranslate"><span class="pre">`Phoenics</span></code> &lt;<a class="reference external" href="https://github.com/aspuru-guzik-group/phoenics">https://github.com/aspuru-guzik-group/phoenics</a>&gt;`__. This
algorithm, originally developed within the Aspuru-Guzik group, can be
accessed in the usual fashion. It’s performance on the two-qubit
optimization circuit is shown below. Note that the number of datapoints
exceeds the provided <strong>maxiter</strong>; <strong>maxiter</strong> here controls the number
of parameter <strong>batches</strong> suggested by phoenics. phoenics suggests a
number of parameter sets to try out, per batch, that scales with the
number of parameters (in a nonlinear fashion), so you may want to set
maxiter lower if you are only playing around.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="mf">0.25</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With phoenics we will optimize:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">O1</span><span class="p">)</span>
<span class="c1">### to see what you can pass down to phoenics, see the tequila documentation for that module.</span>
<span class="n">p_result</span><span class="o">=</span><span class="n">tq</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="n">O1</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Phoenics&#39;</span><span class="p">,</span>
            <span class="n">maxiter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">initial_values</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Phoenics optimization results on 2 qubit circuit:&#39;</span><span class="p">)</span>
<span class="n">p_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;energies&#39;</span><span class="p">)</span>
<span class="n">p_result</span><span class="o">.</span><span class="n">history</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;angles&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best energy: &#39;</span><span class="p">,</span><span class="n">p_result</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;optimal angles: &#39;</span><span class="p">,</span><span class="n">p_result</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
</pre></div>
</div>
<p>We also have returned to you the phoenics object. One interesting object
we can extract from this is the acquisition function. You can obtain
this indirectly, using
resut.object.bayesian_network.kernel_contribution. This function takes
a numpy array ( a point in your parameter space) and returns 2 numbers,
x and y; the acquisition function then has the value x*y. Note: this is
often zero.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kc</span><span class="o">=</span><span class="n">p_result</span><span class="o">.</span><span class="n">phoenics_instance</span><span class="o">.</span><span class="n">bayesian_network</span><span class="o">.</span><span class="n">kernel_contribution</span>
<span class="n">random_point</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">kc</span><span class="p">(</span><span class="n">random_point</span><span class="p">)</span>
<span class="n">random_ac</span><span class="o">=</span><span class="n">f</span><span class="o">*</span><span class="n">s</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;random point &#39;</span><span class="p">,</span> <span class="n">random_point</span><span class="p">,</span> <span class="s1">&#39; has acquisition function value &#39;</span><span class="p">,</span><span class="n">random_ac</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="this-concludes-our-tutorial-hope-you-had-fun-happy-optimizing">
<h2>This concludes our tutorial. Hope you had fun! Happy optimizing!<a class="headerlink" href="#this-concludes-our-tutorial-hope-you-had-fun-happy-optimizing" title="Permalink to this headline">¶</a></h2>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Matter Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>